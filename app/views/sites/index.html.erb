<%- model_class = Site -%>
<div class="page-header">
  <h2><%= t '.title', :default => model_class.model_name.human.pluralize.titleize %></h2>
</div>

<% if current_user.admin? %>
    <p>
      <%= link_to t('.import', :default => t("helpers.links.import")),
                  import_sites_path, :class => 'btn btn-primary' %>
      <%= link_to t('.export', :default => t("helpers.links.export")),
                  export_sites_path, :class => 'btn btn-primary' %>
    </p>
    <p><%= link_to t('.new', :default => t("helpers.links.new")),
                   new_url_path,
                   :class => 'btn btn-primary' %>
      <%= link_to t('.update_prices', :default => t("helpers.links.update_prices")),
                  update_prices_urls_path, :class => 'btn btn-primary' %>
      <%= link_to t('.update_violators', :default => t("helpers.links.update_violators")),
                  update_violators_urls_path, :class => 'btn btn-primary' %>
      <%= link_to t('.find_urls', :default => t("helpers.links.find_urls")),
                  find_urls_urls_path, :class => 'btn btn-primary' %>
    </p>
<% end %>



<table class="table table-striped">
  <thead>
  <tr>
    <th><%= model_class.human_attribute_name(:name) %></th>
    <th><%= model_class.human_attribute_name(:group) %></th>
    <th><%= model_class.human_attribute_name(:company_name) %></th>
    <th><%= model_class.human_attribute_name(:out_of_ban_time) %></th>
    <th><%= t '.actions', :default => t("helpers.actions") %></th>
  </tr>
  </thead>
  <tbody>
  <% @sites.order(:name).each do |site| %>
      <tr <%= (site.violator?) ? " class=\"error\"".html_safe : "" %>"" >
      <td><%= link_to site.name, site_path(site), class: "tdfade" %></td>
      <td>
        <% site.groups.each do |group| %>
            <%= group.name %>
        <% end %></td>
      <td><%= site.company_name %></td>
      <td><%= (site.out_of_ban_time.nil?) ? "-" : distance_of_time_in_words_to_now(site.out_of_ban_time) %></td>

      <td>
        <% if current_user.admin? %>
            <%= link_to t('.edit', :default => t("helpers.links.edit")),
                        edit_site_path(site), :class => 'btn btn-mini' %>


            <%= link_to t('.destroy', :default => t("helpers.links.destroy")),
                        site_path(site),
                        :method => :delete,
                        :data => {:confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?'))},
                        :class => 'btn btn-mini btn-danger' %>
        <% end %>
        <%= link_to t('.update_prices', :default => t("helpers.links.update_prices")),
                    update_prices_urls_path(:site => site), :class => 'btn btn-mini' %>
      </td>
      </tr>
  <% end %>
  </tbody>
</table>

<%= link_to t('.new', :default => t("helpers.links.new")),
            new_site_path,
            :class => 'btn btn-primary' %>
